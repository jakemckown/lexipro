!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Preprocessor=e()}(this,(function(){"use strict";var t=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){function e(t){"function"!=typeof t&&(t=e.defunct);var n=[],i=[],r=0;function o(){for(var t=[],e=0,n=this.state,r=this.index,o=this.input,s=0,c=i.length;s<c;s++){var u=i[s],h=u.start,a=h.length;if(!a||h.indexOf(n)>=0||n%2&&1===a&&!h[0]){var l=u.pattern;l.lastIndex=r;var f=l.exec(o);if(f&&f.index===r){var p=t.push({result:f,action:u.action,length:f[0].length});for(u.global&&(e=p);--p>e;){var d=p-1;if(t[p].length>t[d].length){var x=t[p];t[p]=t[d],t[d]=x}}}}}return t}this.state=0,this.index=0,this.input="",this.addRule=function(t,e,n){var r=t.global;if(!r){var o="g";t.multiline&&(o+="m"),t.ignoreCase&&(o+="i"),t=new RegExp(t.source,o)}return"[object Array]"!==Object.prototype.toString.call(n)&&(n=[0]),i.push({pattern:t,global:r,action:e,start:n}),this},this.setInput=function(t){return r=0,this.state=0,this.index=0,n.length=0,this.input=t,this},this.lex=function(){if(n.length)return n.shift();for(this.reject=!0;this.index<=this.input.length;){for(var e=o.call(this).splice(r),i=this.index;e.length&&this.reject;){var s=e.shift(),c=s.result,u=s.length;this.index+=u,this.reject=!1,r++;var h=s.action.apply(this,c);if(this.reject)this.index=c.index;else if(void 0!==h)switch(Object.prototype.toString.call(h)){case"[object Array]":n=h.slice(1),h=h[0];default:return u&&(r=0),h}}var a=this.input;if(i<a.length){if(this.reject){if(r=0,void 0!==(h=t.call(this,a.charAt(this.index++))))return"[object Array]"===Object.prototype.toString.call(h)?(n=h.slice(1),h[0]):h}else this.index!==i&&(r=0),this.reject=!0}else{if(!e.length)break;this.reject=!0}}}}t.exports=e,e.defunct=function(t){throw new Error("Unexpected character at index "+(this.index-1)+": "+t)}}));return function(){var e=new t((function(t){return t})),n=function(){},i={index:{configurable:!0}};return i.index.get=function(){return e.index},n.prototype.addRule=function(t,n){return e.addRule(t,n),this},n.prototype.preprocess=function(t){e.setInput(t);for(var n=[];e.index<t.length;){var i=e.lex();n.push(i)}return n.filter((function(t){return null!==t})).join("")},Object.defineProperties(n.prototype,i),new n}}));
